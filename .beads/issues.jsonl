{"id":"damus-d18","title":"iOS 15 PR feedback fixes - critical bugs and refactoring","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T08:28:22.538414-06:00","created_by":"e","updated_at":"2026-01-04T08:28:22.538414-06:00","comments":[{"id":7,"issue_id":"damus-d18","author":"e","text":"## PR Feedback to Address\n\n### ðŸ”´ Critical Issues\n1. **SwiftyCrop local dependency** - /tmp/SwiftyCrop-iOS15 breaks builds for other developers\n2. **ChatEventView.swift** - Infinite recursion in ChatSheetPresentationModifier (line 19)\n3. **RelayDetailView.swift** - Infinite recursion in scrollIndicatorsHiddenCompat (line 17)\n4. **SideMenuView.swift** - Infinite recursion in scrollIndicatorsHiddenCompat (line 18)\n5. **DamusPurple.swift** - URL path inconsistency at line 341 (missing leading slash)\n\n### ðŸŸ  Major Issues\n6. **DRY violation** - scrollIndicatorsHiddenCompat() duplicated in multiple files, centralize to iOS15Compatibility.swift\n\n### ðŸŸ¡ Minor Issues\n7. **iOS15Compatibility.swift** - Unused mediumHeight parameter in presentationDetentsHeightMediumLarge","created_at":"2026-01-04T14:28:36Z"},{"id":8,"issue_id":"damus-d18","author":"e","text":"## PR Feedback Fixes Complete\n\n### All Issues Resolved:\n\n1. âœ… **SwiftyCrop local dependency** - Forked to alltheseas/SwiftyCrop, pushed ios-15-support branch, updated project.pbxproj and Package.resolved to use remote URL\n\n2. âœ… **Infinite recursion in ChatEventView.swift** - Changed recursive `content.modifier(ChatSheetPresentationModifier())` to `content.presentationDetents([.medium, .large])`\n\n3. âœ… **Infinite recursion in RelayDetailView.swift** - Added private extension with proper implementation\n\n4. âœ… **Infinite recursion in SideMenuView.swift** - Added private extension with proper implementation\n\n5. âœ… **URL path in DamusPurple.swift** - Changed `\"checkout\"` to `\"/checkout\"`\n\n6. âœ… **DRY violation for scrollIndicatorsHiddenCompat** - Using private extensions per-file (cannot centralize due to Xcode target configuration)\n\n7. âœ… **Unused mediumHeight parameter** - Fixed to use the parameter in presentationDetentsHeightMediumLarge\n\n### Build Status: âœ… SUCCESS\n\nFiles with private scrollIndicatorsHiddenCompat extensions (required due to target config):\n- EventTags.swift\n- RelayNipList.swift\n- RelayDetailView.swift\n- LongformPreview.swift\n- SideMenuView.swift\n- ZapExplainer.swift","created_at":"2026-01-04T14:52:54Z"}]}
{"id":"damus-p47","title":"ios-15-nav","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T14:27:28.798315-06:00","created_by":"e","updated_at":"2026-01-03T14:27:28.798315-06:00","comments":[{"id":1,"issue_id":"damus-p47","author":"e","text":"## iOS 15 Navigation Support Progress\n\n### Summary\nImplementing iOS 15 navigation support for damus iOS app using NavigationBackport library.\n\n### Completed\n1. Added NavigationBackport SPM dependency\n2. Lowered iOS deployment target from 16.0 to 15.0\n3. Replaced NavigationStack with NBNavigationStack in ContentView and SetupView\n4. Created iOS 15 compatibility helpers for iOS 16+ APIs\n5. Forked SwiftyCrop to support iOS 15\n6. Fixed numerous iOS 16+ API usages:\n   - NavigationLink(value:) â†’ NBNavigationLink(value:)\n   - presentationDetents â†’ ViewModifier with #available\n   - scrollIndicators â†’ compat extension\n   - Duration â†’ TimeInterval\n   - Task.sleep(for:) â†’ Task.sleep(nanoseconds:)\n   - URL.append(path:) â†’ compat extension\n   - TextField axis parameter â†’ wrapper view\n   - ShareLink â†’ #available wrapper\n   - fontWeight on Image â†’ font(.body.bold())\n   - host() â†’ host property\n\n### In Progress\n- Fixing remaining iOS 16+ API errors and rebuilding\n\n### Pending\n- Test on iOS 15 simulator\n- Create commits for all changes","created_at":"2026-01-03T20:27:39Z"},{"id":2,"issue_id":"damus-p47","author":"e","text":"## Progress Update\n\n### Build Status\nGetting closer - now only 2 errors remaining (was ~50+)\n\n### Recent Fixes\n- RelayConfigView.swift - presentationDetents/DragIndicator\n- QRCodeView.swift - presentationDetents\n- RepostedEvent.swift - NBNavigationLink\n- SearchingEventView.swift - NBNavigationLink\n- LogoView.swift - reordered .tracking() before other modifiers\n- PostView.swift - moved fontWeight to Text inside Button\n- Many other NavigationLink, scrollIndicators, fontWeight fixes\n\n### Remaining Errors (2)\n1. ReactionsSettingsView.swift:36 - presentationDetents\n2. HighlightLink.swift:38 - host(percentEncoded:)\n\n### Pattern Summary\niOS 16+ APIs requiring fixes:\n- NavigationLink(value:) â†’ NBNavigationLink(value:)\n- presentationDetents â†’ ViewModifier with #available\n- scrollIndicators â†’ compat extension with #available\n- fontWeight on View â†’ move to Text or reorder modifiers\n- URL.host() â†’ URL.host property\n- TextField axis â†’ wrapper view\n- Duration â†’ TimeInterval\n- Task.sleep(for:) â†’ Task.sleep(nanoseconds:)","created_at":"2026-01-03T20:36:51Z"},{"id":3,"issue_id":"damus-p47","author":"e","text":"## Build SUCCESS! ðŸŽ‰\n\nAll iOS 16+ API errors have been fixed. Build now shows only expected deprecation warnings from NavigationBackport library (NBNavigationLink warns about using SwiftUI's native Navigation API on iOS 16+, which is by design).\n\n### Files Fixed in This Session\n- ProfileView.swift - Added trailingToolbarContent @ViewBuilder computed property to fix ToolbarContentBuilder buildEither error\n- WalletView.swift - LargeSheetModifier for presentationDetents/DragIndicator  \n- ConfigView.swift - NBNavigationLink for all settings items\n- SearchView.swift - hashtagMenuButton @ViewBuilder computed property\n- ContentView.swift - ConditionalToolbarVisibilityModifier, VisibleDragIndicatorModifier, FilterSheetModifier\n- PostingTimelineSwitcherView.swift - menuOrderFixedCompat extension\n- And ~15 more files from previous session work\n\n### Next Step\nTest on iOS 15 simulator to verify runtime behavior","created_at":"2026-01-03T20:53:12Z"},{"id":4,"issue_id":"damus-p47","author":"e","text":"## iOS 15 Simulator Testing\n\niOS 15 runtime not available on this system (only iOS 26.2 installed). However, the build succeeds with:\n- iOS 15.0 deployment target\n- All #available checks properly structured  \n- NavigationBackport library correctly integrated\n\nThe code is verified at compile-time for iOS 15 compatibility. Runtime testing would require downloading iOS 15 runtime via Xcode \u003e Settings \u003e Platforms.\n\n### Ready for Commit\nAll changes ready to be committed. Will create logically distinct commits as per requirements.","created_at":"2026-01-03T20:54:39Z"},{"id":5,"issue_id":"damus-p47","author":"e","text":"## All Changes Committed âœ…\n\nCreated 5 new commits (10 total for iOS 15 support):\n\n```\n82ae1e5f Fix View modifier ordering and fontWeight for iOS 15\n01c12b37 Fix iOS 16+ API usages for iOS 15 compatibility\ne124c9b1 Add iOS 15 compatibility ViewModifiers\n304948fe Replace NavigationLink with NBNavigationLink for iOS 15\n98067813 Update project configuration for iOS 15 support\n0460a549 Fix context menu on UserStatusView for iOS 15\nc1a95390 Fix region lookup for iOS 15 compatibility\nd865d832 Add iOS 15 compatibility helper extensions\n94827935 Replace NavigationStack with NBNavigationStack\n3852e635 Lower iOS deployment target from 16.0 to 15.0\n```\n\n### Summary\n- 63 files changed\n- +870 insertions / -274 deletions\n- All iOS 16+ APIs wrapped with #available checks\n- NavigationBackport integrated for iOS 15 navigation support","created_at":"2026-01-04T06:18:57Z"},{"id":6,"issue_id":"damus-p47","author":"e","text":"## Draft PR Created âœ…\n\n**PR #14**: https://github.com/alltheseas/damus/pull/14\n\n- Marked as DRAFT\n- Testing noted as pending\n- Pushed to alltheseas/damus (personal fork)\n- NOT submitted to upstream damus-io/damus","created_at":"2026-01-04T06:20:32Z"}]}
